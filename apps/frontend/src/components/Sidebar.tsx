"use client"

import React, { useEffect } from "react"
import Link from "next/link"
import { usePathname } from "next/navigation"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/src/components/atoms/Tooltip"
import { useQuery } from "@tanstack/react-query"
import { useAuth } from "../contexts/AuthContext"
import axios from "axios"
import { BACKEND_URL } from "../lib/constants/urls"
import { type User } from "../lib/@types/auth/user"
import Image from "next/image"

const navLinkClassName =
  "flex items-center justify-center gap-2 px-3 py-2.5 rounded-lg text-sm text-secondary-foreground cursor-pointer hover:bg-background-hover"

const SidebarLink = ({
  href,
  icon,
  label,
}: {
  href: string
  icon: React.ReactNode
  label: string
}) => {
  return (
    <TooltipProvider delayDuration={0}>
      <Tooltip>
        <TooltipTrigger asChild>
          <Link className={navLinkClassName} href={href}>
            {icon}
          </Link>
        </TooltipTrigger>
        <TooltipContent side="right">
          <p>{label}</p>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  )
}

const Sidebar: React.FC = () => {
  const pathname = usePathname()

  if (pathname.includes("auth")) {
    return null
  }

  const { session } = useAuth()

  const { data } = useQuery<User>({
    queryKey: ["user"],
    queryFn: async () => {
      try {
        const { data } = await axios.get(`${BACKEND_URL}/users/me`, {
          headers: {
            Authorization: `Bearer ${session}`,
          },
        })
        return data as User
      } catch (error) {
        return error
      }
    },
    staleTime: 1000 * 60 * 5,
  })

  return (
    <div className="flex flex-col justify-between px-3 pb-3 pt-5 border border-border bg-secondary">
      <div className="flex flex-col gap-0.5">
        <SidebarLink
          href="/app/inbox/"
          icon={
            <svg
              width="32"
              height="31"
              viewBox="0 0 32 31"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M4.50959 7.80348C5.04929 5.47456 7.20335 3.81757 9.69123 3.81757H22.4074C24.8953 3.81757 27.0494 5.47456 27.5891 7.80348L27.7841 8.64511C28.7954 13.0086 28.7954 17.532 27.7841 21.8955L27.5891 22.7371C27.0494 25.0661 24.8953 26.723 22.4074 26.723H9.69123C7.20335 26.723 5.04929 25.0661 4.50959 22.7371L4.31455 21.8955C3.30335 17.532 3.30335 13.0086 4.31455 8.64511L4.50959 7.80348Z"
                stroke={pathname === "/app/inbox/" ? "#000" : "#676767"}
                strokeWidth="2.08333"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
              <path
                d="M3.44189 16.5431H11.8523C11.8523 17.8156 13.1434 20.3607 16.3712 20.3607C19.5992 20.3607 20.8902 17.8156 20.8902 16.5431H28.6551"
                stroke={pathname === "/app/inbox/" ? "#000" : "#676767"}
                strokeWidth="2.08333"
                strokeLinejoin="round"
              />
            </svg>
          }
          label="inbox"
        />
        <SidebarLink
          href="/app/today/"
          icon={
            <svg
              width="32"
              height="31"
              viewBox="0 0 32 31"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect
                width="31.8482"
                height="30.5406"
                transform="translate(0.125 0.302368)"
              />
              <path
                d="M9.84234 11.4942C10.3178 11.03 11.0802 10.5923 12.1936 10.5923C13.7185 10.5923 14.7542 11.5273 15.1293 12.6448C15.4959 13.7324 15.2642 15.0653 14.2597 15.9606C13.8761 16.287 13.4656 16.5831 13.0322 16.8459L12.9855 16.8758C12.6138 17.1039 12.2554 17.3513 11.9118 17.6169C11.4848 17.965 11.1477 18.353 10.98 18.8885H14.3202C14.5495 18.8885 14.7693 18.9758 14.9315 19.1313C15.0936 19.2868 15.1846 19.4976 15.1846 19.7175C15.1846 19.9373 15.0936 20.1482 14.9315 20.3036C14.7693 20.4591 14.5495 20.5464 14.3202 20.5464H9.99794C9.76867 20.5464 9.54879 20.4591 9.38668 20.3036C9.22456 20.1482 9.13349 19.9373 9.13349 19.7175C9.13349 18.101 9.8942 17.0863 10.7898 16.3552C11.1909 16.0286 11.6266 15.7501 12.0035 15.5097L12.0726 15.4649C12.4876 15.2013 12.8178 14.9841 13.0806 14.7503C13.2981 14.5479 13.4515 14.2905 13.5231 14.008C13.5947 13.7255 13.5815 13.4294 13.4851 13.1538C13.4072 12.8858 13.2373 12.6509 13.003 12.487C12.7686 12.323 12.4835 12.2396 12.1936 12.2502C11.6041 12.2502 11.2687 12.4657 11.0733 12.6564C10.9656 12.761 10.8768 12.882 10.8105 13.0145L10.8071 13.0228C10.7275 13.229 10.5658 13.3965 10.3575 13.4884C10.1491 13.5802 9.9113 13.589 9.69624 13.5127C9.48119 13.4364 9.30655 13.2813 9.21074 13.0816C9.11493 12.8818 9.1058 12.6537 9.18535 12.4475L9.23376 12.3314C9.26143 12.2762 9.30004 12.2043 9.3496 12.1159C9.45333 11.9435 9.61066 11.718 9.84234 11.4942ZM18.6425 10.5989C18.8717 10.5989 19.0916 10.6862 19.2537 10.8417C19.4158 10.9972 19.5069 11.208 19.5069 11.4279V14.7437H21.2358V11.4279C21.2358 11.208 21.3269 10.9972 21.489 10.8417C21.6511 10.6862 21.871 10.5989 22.1003 10.5989C22.3295 10.5989 22.5494 10.6862 22.7115 10.8417C22.8736 10.9972 22.9647 11.208 22.9647 11.4279V19.7175C22.9647 19.9373 22.8736 20.1482 22.7115 20.3036C22.5494 20.4591 22.3295 20.5464 22.1003 20.5464C21.871 20.5464 21.6511 20.4591 21.489 20.3036C21.3269 20.1482 21.2358 19.9373 21.2358 19.7175V16.4016H18.6425C18.4132 16.4016 18.1933 16.3143 18.0312 16.1588C17.8691 16.0034 17.778 15.7925 17.778 15.5727V11.4279C17.778 11.208 17.8691 10.9972 18.0312 10.8417C18.1933 10.6862 18.4132 10.5989 18.6425 10.5989ZM8.26904 3.96722C7.1227 3.96722 6.02332 4.40391 5.21274 5.18121C4.40216 5.95851 3.94678 7.01276 3.94678 8.11203V23.0333C3.94678 24.1326 4.40216 25.1868 5.21274 25.9641C6.02332 26.7414 7.1227 27.1781 8.26904 27.1781H23.8292C24.9755 27.1781 26.0749 26.7414 26.8855 25.9641C27.696 25.1868 28.1514 24.1326 28.1514 23.0333V8.11203C28.1514 7.01276 27.696 5.95851 26.8855 5.18121C26.0749 4.40391 24.9755 3.96722 23.8292 3.96722H8.26904ZM5.67568 8.11203C5.67568 7.45246 5.94891 6.81992 6.43526 6.35353C6.9216 5.88715 7.58123 5.62514 8.26904 5.62514H23.8292C24.517 5.62514 25.1766 5.88715 25.6629 6.35353C26.1493 6.81992 26.4225 7.45246 26.4225 8.11203V23.0333C26.4225 23.6929 26.1493 24.3254 25.6629 24.7918C25.1766 25.2582 24.517 25.5202 23.8292 25.5202H8.26904C7.58123 25.5202 6.9216 25.2582 6.43526 24.7918C5.94891 24.3254 5.67568 23.6929 5.67568 23.0333V8.11203Z"
                fill={pathname === "/app/today/" ? "#000" : "#676767"}
              />
            </svg>
          }
          label="today"
        />
        <hr className="my-3 border-border" />
        <SidebarLink
          href="/app/space/"
          icon={
            <svg
              width="32"
              height="32"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M24.8063 11.3379C25.8171 11.3373 26.7902 11.704 27.5283 12.3635C28.2664 13.0231 28.7143 13.9261 28.781 14.8894L28.7889 15.1389V24.2649C28.7891 25.2303 28.4048 26.1596 27.714 26.8643C27.0232 27.569 26.0776 27.9964 25.0691 28.0597L24.8079 28.0674H15.2535C14.2428 28.0675 13.2699 27.7004 12.532 27.0406C11.7942 26.3808 11.3468 25.4776 11.2805 24.5143L11.2725 24.2649V15.1389C11.2724 14.1734 11.6567 13.2441 12.3475 12.5394C13.0383 11.8347 13.9838 11.4073 14.9924 11.344L15.2519 11.3379H24.8063ZM20.0307 14.3799C19.8444 14.3798 19.6639 14.4422 19.5208 14.5561C19.3776 14.6701 19.2808 14.8284 19.2473 15.0035L19.2345 15.1404V18.9429H15.2519L15.1086 18.9535C14.925 18.9853 14.759 19.0776 14.6394 19.2144C14.5198 19.3511 14.4543 19.5237 14.4543 19.7019C14.4543 19.88 14.5198 20.0526 14.6394 20.1894C14.759 20.3261 14.925 20.4184 15.1086 20.4502L15.2519 20.4624H19.2329V24.2649L19.2457 24.4017C19.2789 24.5771 19.3756 24.7357 19.5188 24.8499C19.6619 24.9642 19.8426 25.0267 20.0291 25.0267C20.2157 25.0267 20.3963 24.9642 20.5395 24.8499C20.6827 24.7357 20.7794 24.5771 20.8126 24.4017L20.8253 24.2664V20.4639H24.8063L24.9497 20.4517C25.1332 20.42 25.2993 20.3276 25.4189 20.1909C25.5385 20.0541 25.604 19.8816 25.604 19.7034C25.604 19.5252 25.5385 19.3526 25.4189 19.2159C25.2993 19.0791 25.1332 18.9868 24.9497 18.955L24.8063 18.9429H20.8253V15.1404L20.8126 15.0035C20.7791 14.8284 20.6823 14.6701 20.5391 14.5561C20.396 14.4422 20.2155 14.3798 20.0291 14.3799M20.2871 6.30945L20.3635 6.54977L21.2792 9.81535H14.4573C13.2388 9.81529 12.0663 10.26 11.1798 11.0584C10.2932 11.8569 9.75958 12.9488 9.68809 14.1107L9.68013 14.3784V22.5127C8.86658 22.4962 8.07785 22.242 7.42016 21.7843C6.76248 21.3266 6.26743 20.6874 6.00168 19.9528L5.91888 19.6942L3.44588 10.8801C3.18389 9.94762 3.30304 8.95491 3.77914 8.1033C4.25525 7.25169 5.05267 6.60493 6.00964 6.29424L6.26124 6.22275L15.4892 3.86064C16.4222 3.62176 17.4142 3.715 18.2805 4.123C19.1468 4.53099 19.8283 5.22591 20.1979 6.07826L20.2871 6.30945Z"
                fill={pathname === "/app/space/" ? "#000" : "#676767"}
              />
            </svg>
          }
          label="space"
        />
        <SidebarLink
          href="/app/audio/"
          icon={
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M2 10V13M6 6V17M10 3V21M14 8V15M18 5V18M22 10V13"
                stroke={pathname === "/app/audio/" ? "#000" : "#676767"}
                strokeWidth="2"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>
          }
          label="audio"
        />
      </div>
      <div className="flex flex-col gap-0.5">
        <SidebarLink
          href="/app/profile/"
          icon={
            <Image
              src={data ? data.avatar : "/icons/user.webp"}
              alt="profile"
              width={26}
              height={26}
              className="rounded-full bg-gray-color"
            />
          }
          label="profile"
        />
        <SidebarLink
          href="/app/settings/"
          icon={
            <svg
              width="22"
              height="22"
              viewBox="0 0 22 22"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M20.0668 6.20845L19.5858 5.39468C19.2221 4.77924 19.0403 4.47152 18.7308 4.34881C18.4214 4.22611 18.0714 4.32293 17.3715 4.51658L16.1826 4.8431C15.7358 4.94357 15.2669 4.88657 14.8589 4.68218L14.5307 4.49752C14.1808 4.27903 13.9117 3.95689 13.7627 3.57823L13.4374 2.63072C13.2234 2.0037 13.1164 1.69019 12.8617 1.51086C12.6071 1.33154 12.2688 1.33154 11.5922 1.33154H10.506C9.82951 1.33154 9.49121 1.33154 9.23651 1.51086C8.98187 1.69019 8.87489 2.0037 8.66095 2.63072L8.33556 3.57823C8.1866 3.95689 7.91748 4.27903 7.56761 4.49752L7.23937 4.68218C6.83135 4.88657 6.36254 4.94357 5.91569 4.8431L4.72675 4.51658C4.02683 4.32293 3.67688 4.22611 3.36745 4.34881C3.05801 4.47152 2.87616 4.77924 2.51243 5.39468L2.03151 6.20845C1.69057 6.78533 1.5201 7.07378 1.55319 7.38084C1.58626 7.6879 1.81448 7.93535 2.2709 8.43024L3.2755 9.52529C3.52104 9.82834 3.69536 10.3565 3.69536 10.8314C3.69536 11.3065 3.52109 11.8345 3.27553 12.1377L2.2709 13.2328C1.81448 13.7277 1.58627 13.9751 1.55319 14.2822C1.5201 14.5893 1.69057 14.8777 2.03151 15.4545L2.51242 16.2683C2.87614 16.8837 3.05801 17.1915 3.36745 17.3142C3.67688 17.4369 4.02684 17.3401 4.72677 17.1464L5.91565 16.8199C6.36258 16.7194 6.83148 16.7765 7.23954 16.9809L7.56773 17.1656C7.91754 17.3841 8.18659 17.7061 8.33553 18.0848L8.66095 19.0324C8.87489 19.6594 8.98187 19.9729 9.23651 20.1523C9.49121 20.3315 9.82951 20.3315 10.506 20.3315H11.5922C12.2688 20.3315 12.6071 20.3315 12.8617 20.1523C13.1164 19.9729 13.2234 19.6594 13.4374 19.0324L13.7628 18.0848C13.9117 17.7061 14.1807 17.3841 14.5306 17.1656L14.8587 16.9809C15.2668 16.7765 15.7357 16.7194 16.1826 16.8199L17.3715 17.1464C18.0714 17.3401 18.4214 17.4369 18.7308 17.3142C19.0403 17.1915 19.2221 16.8837 19.5858 16.2683L20.0668 15.4545C20.4077 14.8777 20.5781 14.5893 20.5451 14.2822C20.512 13.9751 20.2838 13.7277 19.8274 13.2328L18.8227 12.1377C18.5772 11.8345 18.4029 11.3065 18.4029 10.8314C18.4029 10.3565 18.5773 9.82834 18.8227 9.52529L19.8274 8.43024C20.2838 7.93535 20.512 7.6879 20.5451 7.38084C20.5781 7.07378 20.4077 6.78533 20.0668 6.20845Z"
                stroke={pathname === "/app/settings/" ? "#000" : "#676767"}
                strokeWidth="1.5"
                strokeLinecap="round"
              />
              <path
                d="M14.5491 10.8315C14.5491 12.7645 12.9821 14.3315 11.0491 14.3315C9.11611 14.3315 7.54913 12.7645 7.54913 10.8315C7.54913 8.89854 9.11611 7.33154 11.0491 7.33154C12.9821 7.33154 14.5491 8.89854 14.5491 10.8315Z"
                stroke={pathname === "/app/settings/" ? "#000" : "#676767"}
                strokeWidth="1.5"
              />
            </svg>
          }
          label="settings"
        />
        <SidebarLink
          href="/app/info/"
          icon={
            <svg
              width="22"
              height="23"
              viewBox="0 0 22 23"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M11.0491 21.3315C16.572 21.3315 21.0491 16.8544 21.0491 11.3315C21.0491 5.8087 16.572 1.33154 11.0491 1.33154C5.52629 1.33154 1.04913 5.8087 1.04913 11.3315C1.04913 16.8544 5.52629 21.3315 11.0491 21.3315Z"
                stroke={pathname === "/app/info/" ? "#000" : "#676767"}
                strokeWidth="1.5"
              />
              <path
                d="M9.04913 8.33154C9.04913 7.22697 9.94453 6.33154 11.0491 6.33154C12.1537 6.33154 13.0491 7.22697 13.0491 8.33154C13.0491 8.72969 12.9328 9.10067 12.7322 9.41234C12.1345 10.3412 11.0491 11.2269 11.0491 12.3315V12.8315"
                stroke={pathname === "/app/info/" ? "#000" : "#676767"}
                strokeWidth="1.5"
                strokeLinecap="round"
              />
              <path
                d="M11.0413 16.3315H11.0503"
                stroke={pathname === "/app/info/" ? "#000" : "#676767"}
                strokeWidth="2"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </svg>
          }
          label="info"
        />
      </div>
    </div>
  )
}

export default Sidebar
